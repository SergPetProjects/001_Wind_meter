# Анеморумбометр

Устройство предназначено для работы с датчиком ветра из 
комплекта анеморумбометра [М63М-1](artifacts/m63-m1-ps.pdf "Паспорт")

__Среда разработки:__ VSC 1.97.2\
__Фреймворк:__ PlatformIO 3.3.4\
__Библиотеки:__ 
- marcoschwartz/LiquidCrystal_I2C@^1.1.4
- adafruit/Adafruit Unified Sensor@^1.1.15
- adafruit/DHT sensor library@^1.4.6
  
__Контроллер:__ Arduino Mega 2560\
__Доп. модули:__
- Дисплей LCD2004 I2C
- Датчик температуры и влажности DHT22 AM2302
- Датчик температуры и влажности DHT11 (KY-015)

## !!!!!!!!!!!!!!!Проект в разработке!

### Алгоритм измерения скорости ветра:
1. В течении 10 сек. (_MEASUREMENT_PERIOD) считается количество импульсов (counter) от геркона вертушки
2. Вычисляется период следования импульсов (period_time)
3. Значения периода заносятся в массив (period_array) с затиранием самого старого значения
4. // Объём массива на 10 минут измерений (_ARRAY_PERIOD_VOLUME)
5. Создаётся копия (sort_array) массива значений периодов (раз в 10 секунд)
6. Данная копия сортируется по возрастанию
7. Среднее значение периода (period_middle) берётся из середины сортированного массива
8. Наименьшим значением периода (period_min) берётся третье от начала массива (для отсечения выбегов)
9. Вычисляются скорости ветра: мгновенная (period_time -> wind), средняя за 10 минут (period_middle -> wind_middle), максимальная за 10 минут (period_min -> wind_max)

### Алгоритм измерения азимута ветра:
1. Фиксируется время прихода импульса (tmr_period) от геркона вертушки
2. Фиксируется время прихода импульса (tmr_faza) от геркона флюгарки
3. Вычисляется фазовый сдвиг, соответствующий азимуту и сохраняется в массиве (azimuth_faza[])
4. Значения азимута больше 359 градусов не сохраняются
5. Вачисление среднего значения азимута происходит каждые 2 минуты (_MEASUREMENT_AZIMUTH), или по переполнению массива (azimuth_faza[])
6. Создаётся копия (azimuth_array) актуальной части массива азимутов
7. В массив azimuth_selection[] заносится количество азимутов входящих в 5 градусный интервал (ячейка 0: 0-4 градуса; ячейка 1: 5-9 градусов; ячейка 2: 10-14 градусов и т.д.)
8. Определяется ячейка (select) с наибольшим количеством "азимутов"
9. Номер ячейки переводится в градусную меру (azimuth_middle)

